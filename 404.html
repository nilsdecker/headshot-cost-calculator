<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SpeedyHeadshots — Cost Calculator</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --surface:#fafafa; --ink:#111; --muted:#686868;
    --ring:#e9e9ec; --accent:#2bcff3; --accent-ink:#0e5663;
    --err:#c62828; --radius:14px; --shadow:0 6px 18px rgba(0,0,0,.05);
  }
  * { box-sizing: border-box; }
  html,body { margin:0; background:var(--surface); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
  .wrap { max-width:880px; margin:32px auto; padding:0 20px; }
  header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
  .brand { font-weight:800; letter-spacing:.2px; }
  .brand .dot { color:#fb958a; }
  .actions { display:flex; gap:8px; }
  .btn { appearance:none; border:1.5px solid var(--accent); background:#fff; color:var(--accent-ink); padding:8px 14px; border-radius:10px; cursor:pointer; font-weight:600; }
  .btn:active { transform:translateY(1px); }
  .card { background:#fff; border:1px solid var(--ring); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; }
  /* Tabs */
  .tabs { display:flex; border-bottom:2px solid var(--ring); margin-bottom:18px; }
  .tab { flex:1; text-align:center; padding:10px 0; background:#f4f4f4; color:var(--muted); font-weight:600; cursor:pointer; border:none; }
  .tab[aria-selected="true"] { background:#fff; color:var(--ink); border-bottom:2px solid var(--accent); font-weight:700; }
  select, input[type="number"], input[type="date"] { width:100%; padding:10px; border-radius:10px; border:1px solid var(--ring); background:#fff; font-size:1rem; }
  .switch { display:flex; align-items:center; gap:6px; font-size:.95rem; }
  .summary { background:#fff; border:1px solid var(--ring); border-radius:12px; padding:14px; margin-top:16px; }
  .row2 { display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; margin-bottom:6px; }
  .money { font-variant-numeric:tabular-nums; }
  .total { font-size:1.6rem; font-weight:800; }
  .muted { color:var(--muted); }
  .error { color:var(--err); font-weight:600; font-size:.9rem; }
  .hr { height:1px; background:#eee; margin:12px 0; }
  .slider-wrap { display:flex; align-items:center; gap:10px; margin:8px 0; }
  input[type="range"] { flex:1; }
  .qty-badge { min-width:44px; text-align:center; font-weight:700; border:1px solid var(--ring); border-radius:8px; padding:6px 8px; background:#fff; }
  fieldset { border:1px solid var(--ring); border-radius:12px; padding:10px; margin-bottom:14px; }
  legend { padding:0 6px; color:var(--muted); font-size:.9rem; }
  .when-row { display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
  .when-inline { display:flex; align-items:center; gap:6px; }
  .date-box { display:flex; align-items:center; gap:8px; margin-left:auto; padding:4px 6px; border-radius:8px; }
  .date-box[aria-disabled="true"] { opacity:.6; cursor:pointer; }
  /* Three-column options row with separators */
  .options3 { display:grid; grid-template-columns: 1fr 1fr 1fr; align-items:center; margin-top:10px; border:1px solid var(--ring); border-radius:10px; overflow:hidden; }
  .options3 .col { display:flex; align-items:center; gap:8px; padding:10px 12px; background:#fff; min-height:44px; }
  .options3 .col + .col { border-left:1px solid var(--ring); }
  .options3 .col label { font-weight:600; font-size:.95rem; }
  .options3 input[type="number"] { max-width:120px; }
  /* Solid blue CTA inside summary */
  .cta-wrap { margin-top:20px; text-align:center; }
  .cta-btn { display:inline-block; background:var(--accent); color:#fff !important; font-weight:700; padding:12px 28px; border-radius:10px; text-decoration:none; font-size:1.05rem; }
  .cta-alt { display:block; margin-top:8px; font-size:.9rem; }
  /* Toast */
  .toast { position:fixed; left:50%; bottom:20px; transform:translateX(-50%); background:#111; color:#fff; padding:8px 14px; border-radius:10px; box-shadow:var(--shadow); opacity:0; pointer-events:none; transition:opacity .2s, transform .2s; }
  .toast.show { opacity:1; transform:translateX(-50%) translateY(-4px); }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">SPEEDYHEADSHOTS<span class="dot">.</span> Calculator</div>
    <div class="actions">
      <button id="email-link" class="btn">Email this estimate</button>
      <button id="copy-link" class="btn">Copy link</button>
    </div>
  </header>

  <section class="card">
    <div class="tabs" role="tablist">
      <button class="tab" id="tab-team" aria-controls="panel-team" aria-selected="true">Team / Business</button>
      <button class="tab" id="tab-ind" aria-controls="panel-ind" aria-selected="false">Individual / Modeling</button>
    </div>

    <!-- WHEN -->
    <fieldset>
      <legend>When</legend>
      <div class="when-row" role="radiogroup" aria-label="When">
        <label class="when-inline"><input type="radio" name="when" id="when-unknown" checked> I don't know</label>
        <label class="when-inline"><input type="radio" name="when" id="when-specific"> A specific date</label>
        <div id="date-box" class="date-box" aria-disabled="true">
          <span class="muted">Date</span>
          <input type="date" id="when-date" disabled>
        </div>
        <label class="when-inline"><input type="checkbox" id="when-flex" disabled> I'm flexible</label>
      </div>
    </fieldset>

    <!-- TEAM -->
    <div id="panel-team" role="tabpanel" aria-labelledby="tab-team">
      <label>Team size</label>
      <div class="slider-wrap">
        <input id="team-count" type="range" min="4" max="50" step="1" value="4">
        <div id="team-count-badge" class="qty-badge">4</div>
      </div>
      <div id="team-min-error" class="error" style="display:none">minimum quantity is 4 team members</div>

      <div class="options3">
        <div class="col">
          <label for="team-extra-retouch">Extra retouched images</label>
          <input id="team-extra-retouch" type="number" min="0" step="1" value="0" />
        </div>
        <div class="col">
          <label class="switch" for="team-dayrate"><input id="team-dayrate" type="checkbox"> Use Day Rate ($2,750)</label>
        </div>
        <div class="col">
          <label class="switch" for="team-add-hst"><input id="team-add-hst" type="checkbox"> Add HST (13%)</label>
        </div>
      </div>

      <div class="summary">
        <div class="row2"><div class="muted">Rate basis</div><div id="team-rate-basis" class="money" style="text-align:right">—</div></div>
        <div class="row2"><div class="muted">Included retouched images</div><div id="team-included" class="money" style="text-align:right">0</div></div>
        <div class="hr"></div>
        <div class="row2"><div class="muted">Subtotal</div><div id="team-subtotal" class="money" style="text-align:right">$0.00</div></div>
        <div class="row2"><div class="muted">Extra retouches</div><div id="team-extra" class="money" style="text-align:right">$0.00</div></div>
        <div class="row2"><div class="muted">HST</div><div id="team-hst" class="money" style="text-align:right">$0.00</div></div>
        <div class="hr"></div>
        <div class="row2"><div class="total">Total</div><div id="team-total" class="total money" style="text-align:right">$0.00</div></div>

        <!-- CTA inside TEAM summary -->
        <div class="cta-wrap">
          <p style="margin-bottom:12px; font-size:0.95rem;">
            Call / text <a href="tel:13473661342">347-366-1342</a> ·
            Email <a href="mailto:hi@speedyheadshots.com">hi@speedyheadshots.com</a>
          </p>
          <a href="https://www.speedyheadshots.com/contact" target="_blank" rel="noopener" class="cta-btn book-now-btn">Book Now</a>
          <a href="#" class="cta-alt" id="email-fallback-team">Prefer email? Click to draft with your quote link</a>
        </div>
      </div>
    </div>

    <!-- INDIVIDUAL / MODELING -->
    <div id="panel-ind" role="tabpanel" aria-labelledby="tab-ind" hidden>
      <label>Package
        <select id="ind-package">
          <optgroup label="Corporate">
            <option value="corp-mini">Mini — $250 (1 retouched)</option>
            <option value="corp-pro">Professional — $385 (2 retouched)</option>
            <option value="corp-exec">Executive — $550 (5 retouched)</option>
          </optgroup>
          <optgroup label="Actor">
            <option value="actor-stage">Stage Extra — $250 (1 retouched)</option>
            <option value="actor-broadway">Broadway — $500 (3 retouched)</option>
            <option value="actor-hollywood">Hollywood — $675 (5 retouched)</option>
          </optgroup>
          <optgroup label="Modeling">
            <option value="model-mini">Modeling — Mini $175 (1 retouched)</option>
            <option value="model-lookbook">Look Book $475 (3 retouched)</option>
            <option value="model-editorial">Editorial $675 (5 retouched)</option>
          </optgroup>
        </select>
      </label>

      <div class="options3">
        <div class="col">
          <label for="ind-extra-retouch">Extra retouched images</label>
          <input id="ind-extra-retouch" type="number" min="0" step="1" value="0" />
        </div>
        <div class="col">
          <span class="muted">Package includes shown below</span>
        </div>
        <div class="col">
          <label class="switch" for="ind-add-hst"><input id="ind-add-hst" type="checkbox"> Add HST (13%)</label>
        </div>
      </div>

      <div class="summary">
        <div class="row2"><div class="muted">Package</div><div id="ind-package-name" class="money" style="text-align:right">—</div></div>
        <div class="row2"><div class="muted">Included retouched images</div><div id="ind-included" class="money" style="text-align:right">0</div></div>
        <div class="hr"></div>
        <div class="row2"><div class="muted">Subtotal</div><div id="ind-subtotal" class="money" style="text-align:right">$0.00</div></div>
        <div class="row2"><div class="muted">Extra retouches</div><div id="ind-extra" class="money" style="text-align:right">$0.00</div></div>
        <div class="row2"><div class="muted">HST</div><div id="ind-hst" class="money" style="text-align:right">$0.00</div></div>
        <div class="hr"></div>
        <div class="row2"><div class="total">Total</div><div id="ind-total" class="total money" style="text-align:right">$0.00</div></div>

        <!-- CTA inside IND summary -->
        <div class="cta-wrap">
          <p style="margin-bottom:12px; font-size:0.95rem;">
            Call / text <a href="tel:13473661342">347-366-1342</a> ·
            Email <a href="mailto:hi@speedyheadshots.com">hi@speedyheadshots.com</a>
          </p>
          <a href="https://www.speedyheadshots.com/contact" target="_blank" rel="noopener" class="cta-btn book-now-btn">Book Now</a>
          <a href="#" class="cta-alt" id="email-fallback-ind">Prefer email? Click to draft with your quote link</a>
        </div>
      </div>
    </div>
  </section>
</div>

<div id="toast" class="toast">Link copied</div>

<script>
  // --- Pricing constants & data ---
  const HST = 0.13, EXTRA = 25;
  const IND_PACKAGES = {
    "corp-mini": { name: "Corporate — Mini", price: 250, included: 1 },
    "corp-pro":  { name: "Corporate — Professional", price: 385, included: 2 },
    "corp-exec": { name: "Corporate — Executive", price: 550, included: 5 },
    "actor-stage": { name: "Actor — Stage Extra", price: 250, included: 1 },
    "actor-broadway": { name: "Actor — Broadway", price: 500, included: 3 },
    "actor-hollywood": { name: "Actor — Hollywood", price: 675, included: 5 },
    "model-mini": { name: "Modeling — Mini", price: 175, included: 1 },
    "model-lookbook": { name: "Look Book", price: 475, included: 3 },
    "model-editorial": { name: "Editorial", price: 675, included: 5 }
  };
  const perPersonRate = (n)=> n>=20?125 : n>=10?150 : n>=4?175 : null;

  // --- Helpers ---
  const $ = s => document.querySelector(s);
  const money = n => "$" + n.toFixed(2);
  const toast = $("#toast");
  const showToast = t => { toast.textContent = t; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),1500); };

  // --- Tabs ---
  const tabTeam=$("#tab-team"), tabInd=$("#tab-ind");
  const panelTeam=$("#panel-team"), panelInd=$("#panel-ind");
  function showTeam(){ tabTeam.setAttribute("aria-selected","true"); tabInd.setAttribute("aria-selected","false"); panelTeam.hidden=false; panelInd.hidden=true; }
  function showInd(){ tabInd.setAttribute("aria-selected","true"); tabTeam.setAttribute("aria-selected","false"); panelInd.hidden=false; panelTeam.hidden=true; }
  tabTeam.addEventListener("click", showTeam);
  tabInd.addEventListener("click", showInd);

  // --- When / Date ---
  const whenUnknown=$("#when-unknown"), whenSpecific=$("#when-specific"), whenDate=$("#when-date"), whenFlex=$("#when-flex"), dateBox=$("#date-box");
  function updateWhen(){ const spec=whenSpecific.checked; whenDate.disabled=!spec; whenFlex.disabled=!spec; dateBox.setAttribute("aria-disabled", String(!spec)); }
  whenUnknown.addEventListener("change", updateWhen);
  whenSpecific.addEventListener("change", updateWhen);
  dateBox.addEventListener("click", () => { if (!whenSpecific.checked) { whenSpecific.checked=true; whenUnknown.checked=false; updateWhen(); } setTimeout(()=>whenDate.focus(),0); });

  // --- Individual / Modeling calc ---
  const indPkgSel=$("#ind-package"), indExtra=$("#ind-extra-retouch"), indHst=$("#ind-add-hst");
  const indPkgName=$("#ind-package-name"), indIncluded=$("#ind-included"), indSubtotal=$("#ind-subtotal"), indExtraOut=$("#ind-extra"), indHstOut=$("#ind-hst"), indTotal=$("#ind-total");
  function calcIndividual(){
    const pkg=IND_PACKAGES[indPkgSel.value];
    const extraCount=Math.max(0,parseInt(indExtra.value||"0",10));
    const extras=extraCount*EXTRA;
    const base=pkg.price, subtotal=base+extras, hst=indHst.checked?subtotal*HST:0, total=subtotal+hst;
    indPkgName.textContent=pkg.name; indIncluded.textContent=String(pkg.included);
    indSubtotal.textContent=money(base); indExtraOut.textContent=money(extras);
    indHstOut.textContent=money(hst); indTotal.textContent=money(total);
  }
  ["change","input"].forEach(ev=>{ indPkgSel.addEventListener(ev,calcIndividual); indExtra.addEventListener(ev,calcIndividual); indHst.addEventListener(ev,calcIndividual); });

  // --- Team calc (auto day-rate at 23+) ---
  const teamCount=$("#team-count"), teamBadge=$("#team-count-badge");
  const teamExtra=$("#team-extra-retouch"), teamHst=$("#team-add-hst"), teamDay=$("#team-dayrate");
  const teamRateBasis=$("#team-rate-basis"), teamIncluded=$("#team-included"), teamSubtotal=$("#team-subtotal"), teamExtraOut=$("#team-extra"), teamHstOut=$("#team-hst"), teamTotal=$("#team-total"), teamErr=$("#team-min-error");
  function calcTeam(){
    const n=Math.max(0,parseInt(teamCount.value||"4",10));
    teamBadge.textContent=String(n);
    if(n<4){ teamErr.style.display="block"; teamRateBasis.textContent="minimum quantity is 4 team members"; teamIncluded.textContent="0"; teamSubtotal.textContent=money(0); teamExtraOut.textContent=money(0); teamHstOut.textContent=money(0); teamTotal.textContent=money(0); return; }
    teamErr.style.display="none";
    if(n>=23) teamDay.checked=true; // auto day-rate
    const useDay=teamDay.checked, extraCount=Math.max(0,parseInt(teamExtra.value||"0",10)), extras=extraCount*EXTRA;
    const base=useDay?2750:n*perPersonRate(n), basis=useDay?"Day rate ($2,750)":`${n} × $${perPersonRate(n)} per person`, included=useDay?25:n;
    const subtotal=base+extras, hst=teamHst.checked?subtotal*HST:0, total=subtotal+hst;
    teamRateBasis.textContent=basis; teamIncluded.textContent=String(included);
    teamSubtotal.textContent=money(base); teamExtraOut.textContent=money(extras);
    teamHstOut.textContent=money(hst); teamTotal.textContent=money(total);
  }
  ["change","input"].forEach(ev=>{ teamCount.addEventListener(ev,calcTeam); teamExtra.addEventListener(ev,calcTeam); teamHst.addEventListener(ev,calcTeam); teamDay.addEventListener(ev,calcTeam); });

  // --- Robust quote link builder (query + hash) ---
  // URL-safe Base64 (ASCII JSON only; no escape/unescape needed)
  const toB64 = (str) => {
    const raw = btoa(str);
    return raw.replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
  };
  const fromB64 = (b64) => {
    const pad = b64.length % 4 ? 4 - (b64.length % 4) : 0;
    const base = b64.replace(/-/g,'+').replace(/_/g,'/') + '='.repeat(pad);
    return atob(base);
  };

  function buildState(){
    const mode = panelTeam.hidden ? 'ind' : 'team';
    const s = { m: mode, w: whenSpecific.checked ? 'date' : 'unknown' };
    if (s.w === 'date') { s.d = whenDate.value || ''; s.f = whenFlex.checked ? 1 : 0; }
    if (mode === 'team') { s.tc = +teamCount.value; s.te = +teamExtra.value || 0; s.th = teamHst.checked ? 1 : 0; s.td = teamDay.checked ? 1 : 0; }
    else { s.ip = indPkgSel.value; s.ie = +indExtra.value || 0; s.ih = indHst.checked ? 1 : 0; }
    return s;
  }

  function buildQuoteURL(){
    const id = toB64(JSON.stringify(buildState()));
    const base = `${location.origin}${location.pathname}`;
    // include both ?q= and #q= so it survives link wrappers that strip fragments
    return `${base}?q=${id}#q=${id}`;
  }

  function applyState(s){
    (s.m === 'ind' ? showInd : showTeam)();
    if (s.w === 'date') { whenSpecific.checked=true; whenUnknown.checked=false; updateWhen(); if(s.d) whenDate.value=s.d; whenFlex.checked=!!s.f; }
    else { whenUnknown.checked=true; whenSpecific.checked=false; updateWhen(); }
    if (s.m === 'team') {
      if (typeof s.tc === 'number') teamCount.value = Math.max(4, Math.min(50, s.tc));
      teamExtra.value = s.te ?? 0; teamHst.checked = s.th === 1; teamDay.checked = s.td === 1; calcTeam();
    } else {
      if (s.ip) indPkgSel.value = s.ip;
      indExtra.value = s.ie ?? 0; indHst.checked = s.ih === 1; calcIndividual();
    }
  }

  // Restore from hash first, then query (?q=) as fallback, then normalize to #q=
  let restoredFromHash = false;
  (function restoreFromLink(){
    let id = null;
    const hashMatch = location.hash.match(/[#&]q=([^&]+)/);
    if (hashMatch) { id = hashMatch[1]; restoredFromHash = true; }
    if (!id) {
      const qs = new URLSearchParams(location.search);
      if (qs.has('q')) id = qs.get('q');
    }
    if (!id) return;

    try {
      const state = JSON.parse(fromB64(id));
      applyState(state);
      // normalize URL to hash format only
      const base = `${location.origin}${location.pathname}`;
      history.replaceState({}, '', `${base}#q=${id}`);
    } catch(e) { /* ignore bad payload */ }
  })();

  // Copy / Email
  $("#copy-link").addEventListener("click", () => {
    const url=buildQuoteURL();
    navigator.clipboard.writeText(url).then(()=>showToast('Link copied'));
    history.replaceState({},'',url);
  });
  $("#email-link").addEventListener("click", () => {
    const url=buildQuoteURL();
    const subject=encodeURIComponent('SpeedyHeadshots estimate');
    const body=encodeURIComponent(`View estimate: ${url}`);
    location.href=`mailto:?subject=${subject}&body=${body}`;
  });

  // Book Now → open contact with quote details + copy to clipboard
  function openContactWithQuote() {
    const quoteURL = buildQuoteURL();
    const contact = new URL('https://www.speedyheadshots.com/contact');
    contact.searchParams.set('quote', quoteURL);
    contact.searchParams.set('subject', 'New quote from Cost Calculator');
    contact.searchParams.set('message', `Quote link: ${quoteURL}`);
    if (navigator.clipboard?.writeText) { navigator.clipboard.writeText(quoteURL).catch(()=>{}); }
    window.open(contact.toString(), '_blank', 'noopener');
  }
  document.querySelectorAll('.book-now-btn').forEach(btn => btn.addEventListener('click', (e)=>{ e.preventDefault(); openContactWithQuote(); }));

  // Optional “email instead” fallback (pre-populated mailto)
  function openMailtoWithQuote() {
    const quoteURL = buildQuoteURL();
    const subject='New quote from Cost Calculator';
    const body=`Quote link: ${quoteURL}`;
    if (navigator.clipboard?.writeText) { navigator.clipboard.writeText(quoteURL).catch(()=>{}); }
    location.href = `mailto:hi@speedyheadshots.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  }
  $("#email-fallback-team")?.addEventListener('click', (e)=>{ e.preventDefault(); openMailtoWithQuote(); });
  $("#email-fallback-ind")?.addEventListener('click', (e)=>{ e.preventDefault(); openMailtoWithQuote(); });

  // Init defaults only if not restored via link
  (function init(){
    if (!restoredFromHash) {
      showTeam();
      updateWhen();
      calcIndividual();
      calcTeam();
    }
  })();
</script>
</body>
</html>